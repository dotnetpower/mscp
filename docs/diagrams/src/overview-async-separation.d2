direction: down

title: "Asynchronous Separation" {
  style: {
    font-size: 20
    bold: true
    underline: false
  }
}

user_msg: "User Message" {
  shape: rectangle
  style: {
    fill: "#e8f5e9"
    stroke: "#4caf50"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 14
  }
}

response_path: "ðŸŸ¢ Response Path (synchronous)" {
  style: {
    fill: "#ede7f6"
    stroke: "#673ab7"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  preprocessing: "Preprocessing" {
    style: { fill: "#d1c4e9"; stroke: "#512da8"; border-radius: 6; font-size: 11 }
  }
  pipeline: "Cognitive Pipeline" {
    style: { fill: "#d1c4e9"; stroke: "#512da8"; border-radius: 6; font-size: 11 }
  }
  llm_call: "LLM Call" {
    style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6; font-size: 11 }
  }
  streaming: "Streaming Response" {
    style: { fill: "#d1c4e9"; stroke: "#512da8"; border-radius: 6; font-size: 11 }
  }
  ttft: "Target: TTFT < 2 seconds" {
    shape: text
    style: { font-size: 10; italic: true; font-color: "#512da8" }
  }

  preprocessing -> pipeline: { style.animated: true; style.stroke: "#673ab7" }
  pipeline -> llm_call: { style.animated: true; style.stroke: "#673ab7" }
  llm_call -> streaming: { style.animated: true; style.stroke: "#673ab7" }
}

mscp_path: "ðŸ”µ MSCP Path (asynchronous, background)" {
  style: {
    fill: "#e3f2fd"
    stroke: "#2196f3"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  trigger_node: "Triggered after response completion" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6; font-size: 11 }
  }
  reflect: "Cycle results reflected in the\nNEXT interaction's state" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6; font-size: 11 }
  }
  trigger_node -> reflect: { style.animated: true; style.stroke: "#2196f3" }
}

# Main flow
user_msg -> response_path: "sync" {
  style.animated: true
  style.stroke: "#673ab7"
  style.font-size: 11
}
user_msg -> mscp_path: "async (background)" {
  style.animated: true
  style.stroke: "#2196f3"
  style.font-size: 11
}

# Feedback arrow from MSCP back (dashed)
mscp_path -> response_path: "state for next cycle" {
  style.stroke-dash: 5
  style.stroke: "#9e9e9e"
  style.font-size: 10
  style.italic: true
}
