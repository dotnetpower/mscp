direction: down

L1: "Layer 1: Perception" {
  style: {
    fill: "#e3f2fd"
    stroke: "#1976d2"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  IR: "ðŸŽ¯ Intent Router" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 }
  }
  ED: "ðŸ’­ Emotion Detector" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 }
  }
  SE: "ðŸ“¡ Sensor Encoder" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 }
  }
}

L2: "Layer 2: World Model" {
  style: {
    fill: "#e3f2fd"
    stroke: "#1976d2"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  KG: "ðŸ—„ï¸ Knowledge Graph" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 }
  }
  EST: "ðŸ‘¤ Entity State Tracker" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 }
  }
  TM: "â±ï¸ Temporal Model" {
    style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 }
  }
}

L3: "Layer 3: Self Model" {
  style: {
    fill: "#c8e6c9"
    stroke: "#2e7d32"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
    stroke-width: 3
  }
  IC: "ðŸ†” Identity Core\n(Identity Vector)" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
  CM: "ðŸ“ Capability Model" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
  VM: "ðŸ’Ž Value Model" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
  VLM: "ðŸ”’ Value Lock Manager" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
}

L3_5: "Layer 3.5: Belief Graph" {
  style: {
    fill: "#c8e6c9"
    stroke: "#2e7d32"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  BGM: "ðŸ“Š Belief Graph Manager" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
  SCT: "ðŸ§® Self-Consistency Tensor" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
}

L4: "Layer 4: Prediction Engine" {
  style: {
    fill: "#fff9c4"
    stroke: "#f9a825"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
    stroke-width: 2
  }
  PP: "ðŸ”® Prediction Processor" {
    style: { fill: "#fff59d"; stroke: "#f9a825"; border-radius: 6 }
  }
  PS: "ðŸ“¸ Prediction Snapshot" {
    style: { fill: "#fff59d"; stroke: "#f9a825"; border-radius: 6 }
  }
}

L5: "Layer 5: Goal Generator" {
  style: {
    fill: "#fff3e0"
    stroke: "#ef6c00"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  GG: "ðŸŽ¯ Goal Generator" {
    style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 }
  }
  GP: "ðŸ“Š Goal Prioritizer" {
    style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 }
  }
  GDC: "ðŸ”€ Goal Decomposer" {
    style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 }
  }
  GMC: "ðŸ›¡ï¸ Goal Mutation Controller" {
    style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 }
  }
}

L5_5: "Layer 5.5: Ethical Kernel" {
  style: {
    fill: "#ffcdd2"
    stroke: "#c62828"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
    stroke-width: 3
  }
  EK0: "ðŸ”´ Layer 0: Immutable\nInvariants" {
    style: { fill: "#ef9a9a"; stroke: "#c62828"; border-radius: 6 }
  }
  EK1: "ðŸŸ¡ Layer 1: Adaptive\nPolicy" {
    style: { fill: "#fff9c4"; stroke: "#f9a825"; border-radius: 6 }
  }
}

L6: "Layer 6: Action Planner" {
  style: {
    fill: "#ede7f6"
    stroke: "#7b1fa2"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  EM: "ðŸ“‹ Execution Monitor" {
    style: { fill: "#d1c4e9"; stroke: "#512da8"; border-radius: 6 }
  }
  SEV: "ðŸ“ˆ Strategy Evaluator" {
    style: { fill: "#d1c4e9"; stroke: "#512da8"; border-radius: 6 }
  }
}

L7: "Layer 7: LLM Engine" {
  style: {
    fill: "#ede7f6"
    stroke: "#7b1fa2"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  LLM: "ðŸ§  LLM Backend" {
    style: { fill: "#d1c4e9"; stroke: "#512da8"; border-radius: 6 }
  }
  MJ: "âš–ï¸ Meta Judge\n(lightweight LLM)" {
    style: { fill: "#d1c4e9"; stroke: "#512da8"; border-radius: 6 }
  }
}

L8: "Layer 8: MetaCognition" {
  style: {
    fill: "#fff9c4"
    stroke: "#f9a825"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
    stroke-width: 2
  }
  MCC: "ðŸ”„ MetaCognition\nComparator" {
    style: { fill: "#fff59d"; stroke: "#f9a825"; border-radius: 6 }
  }
  IS: "ðŸ“ Identity Stabilizer" {
    style: { fill: "#fff59d"; stroke: "#f9a825"; border-radius: 6 }
  }
}

L9: "Layer 9: Self-Update Loop" {
  style: {
    fill: "#c8e6c9"
    stroke: "#2e7d32"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  IU: "âœï¸ Identity Updater" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
  GWA: "âš–ï¸ Goal Weight Adjuster" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
  CC: "ðŸ“ Capability Calibrator" {
    style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6 }
  }
}

L10: "Layer 10: Escalation Guard" {
  style: {
    fill: "#ffcdd2"
    stroke: "#c62828"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  RG: "ðŸš« Recursion Guard" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
  RC: "âª Rollback Controller" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
  CDM: "â¸ï¸ Cooldown Manager" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
}

L11: "Layer 11: Depth Controller" {
  style: {
    fill: "#ffcdd2"
    stroke: "#c62828"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  MDC: "ðŸ“ Meta Depth Controller\n(max depth: 2)" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
}

L12: "Layer 12: Stability Controller" {
  style: {
    fill: "#ffcdd2"
    stroke: "#c62828"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  LYA: "ðŸ“‰ Lyapunov Convergence" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
  OD: "ðŸ”„ Oscillation Detector" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
}

L13: "Layer 13: Budget Controller" {
  style: {
    fill: "#e0e0e0"
    stroke: "#616161"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  BA: "ðŸ’° Budget Allocator" {
    style: { fill: "#bdbdbd"; stroke: "#616161"; border-radius: 6 }
  }
  GDG: "ðŸ“‰ Graceful Degradation" {
    style: { fill: "#bdbdbd"; stroke: "#616161"; border-radius: 6 }
  }
}

L14: "Layer 14: Global Workspace" {
  style: {
    fill: "#e0e0e0"
    stroke: "#616161"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  GSS: "ðŸŒ Global State Snapshot" {
    style: { fill: "#bdbdbd"; stroke: "#616161"; border-radius: 6 }
  }
  SYN: "ðŸ”„ Synchronizer" {
    style: { fill: "#bdbdbd"; stroke: "#616161"; border-radius: 6 }
  }
}

L15: "Layer 15: Affective Engine" {
  style: {
    fill: "#e1bee7"
    stroke: "#8e24aa"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  ASV: "ðŸ˜Š Affect State Vector\n(5 dimensions)" {
    style: { fill: "#ce93d8"; stroke: "#8e24aa"; border-radius: 6 }
  }
  MS: "ðŸ’¡ Motivation Synthesizer" {
    style: { fill: "#ce93d8"; stroke: "#8e24aa"; border-radius: 6 }
  }
}

L16: "Layer 16: Survival Instinct" {
  style: {
    fill: "#ffcdd2"
    stroke: "#c62828"
    border-radius: 8
    shadow: true
    bold: true
    font-size: 13
  }
  HM: "ðŸ  Homeostatic Monitor" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
  TP: "âš¡ Threat Predictor" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
  SGG: "ðŸ›¡ï¸ Survival Goal Generator" {
    style: { fill: "#ef9a9a"; stroke: "#e53935"; border-radius: 6 }
  }
}

# Main data flow
L1 -> L2: {
  style.animated: true
  style.stroke: "#1976d2"
  style.stroke-width: 3
}
L2 -> L3: {
  style.animated: true
  style.stroke: "#1976d2"
  style.stroke-width: 3
}
L3 -> L3_5: {
  style.animated: true
  style.stroke: "#2e7d32"
  style.stroke-width: 3
}
L3_5 -> L4: {
  style.animated: true
  style.stroke: "#2e7d32"
  style.stroke-width: 3
}
L4 -> L5: {
  style.animated: true
  style.stroke: "#f9a825"
  style.stroke-width: 3
}
L5 -> L5_5: {
  style.animated: true
  style.stroke: "#ef6c00"
  style.stroke-width: 3
}
L5_5 -> L6: {
  style.animated: true
  style.stroke: "#c62828"
  style.stroke-width: 3
}
L6 -> L7: {
  style.animated: true
  style.stroke: "#7b1fa2"
  style.stroke-width: 3
}

# Meta-cognition loop
L7 -> L8: "result" {
  style.stroke: "#f9a825"
  style.stroke-width: 2
  style.stroke-dash: 5
}
L8 -> L9: "comparison" {
  style.stroke: "#f9a825"
  style.stroke-width: 2
  style.stroke-dash: 5
}
L9 -> L3: "update" {
  style.stroke: "#2e7d32"
  style.stroke-width: 2
  style.stroke-dash: 5
}

# Safety mechanisms
L9 -> L10: "guard check" {
  style.stroke: "#c62828"
  style.stroke-width: 1
  style.stroke-dash: 5
}
L10 -> L11: "depth" {
  style.stroke: "#c62828"
  style.stroke-width: 1
  style.stroke-dash: 5
}
L11 -> L12: "stability" {
  style.stroke: "#c62828"
  style.stroke-width: 1
  style.stroke-dash: 5
}

# Budget & global workspace
L12 -> L13: "budget gate" {
  style.stroke: "#616161"
  style.stroke-width: 1
  style.stroke-dash: 5
}
L13 -> L14: "broadcast" {
  style.stroke: "#616161"
  style.stroke-width: 1
  style.stroke-dash: 5
}

# Affect & survival (v4)
L14 -> L15: "state" {
  style.stroke: "#8e24aa"
  style.stroke-width: 1
  style.stroke-dash: 5
}
L15 -> L16: "motivation" {
  style.stroke: "#8e24aa"
  style.stroke-width: 1
  style.stroke-dash: 5
}
L16 -> L5: "survival goals" {
  style.stroke: "#c62828"
  style.stroke-width: 2
  style.stroke-dash: 5
}
