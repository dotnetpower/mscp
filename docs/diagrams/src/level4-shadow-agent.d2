MainAgent: "Main Agent" {
  style: {
    fill: "#c8e6c9"
    stroke: "#2e7d32"
    border-radius: 8
    shadow: true
  }

  MA_STATE: "Full State\n(identity, goals, beliefs,\nstrategy, skills)" {
    style: {
      fill: "#e8f5e9"
      stroke: "#388e3c"
      border-radius: 6
    }
  }
}

ShadowInst: "ShadowAgent Instance" {
  style: {
    fill: "#e3f2fd"
    stroke: "#1976d2"
    border-radius: 8
    shadow: true
    stroke-width: 2
  }

  SA_STATE: "Cloned State\n(deep copy)" {
    style: {
      fill: "#bbdefb"
      stroke: "#1976d2"
      border-radius: 6
    }
  }

  SA_RULES: "Invariants:\n* No real actions\n* No main state modification\n* Hard budget limit\n* Max 1 instance at a time\n* Max 20 simulation cycles" {
    style: {
      fill: "#ffcdd2"
      stroke: "#e53935"
      border-radius: 6
    }
  }
}

Result: "Evaluation" {
  style: {
    fill: "#fff9c4"
    stroke: "#f9a825"
    border-radius: 8
    shadow: true
  }

  RES: "Compare:\n* C_shadow vs C_baseline\n* Identity drift\n* Strategy performance" {
    style: {
      fill: "#fff59d"
      stroke: "#f9a825"
      border-radius: 6
    }
  }
}

DISCARD: "Discard" {
  style: {
    fill: "#ef9a9a"
    stroke: "#b71c1c"
    border-radius: 6
  }
}

MainAgent -> ShadowInst: "clone" {
  style.animated: true
}

ShadowInst -> Result: "results" {
  style.animated: true
}

Result -> MainAgent: "safe -> apply" {
  style.stroke-dash: 5
  style.stroke: "#2e7d32"
}

Result -> DISCARD: "unsafe -> discard" {
  style.stroke-dash: 5
  style.stroke: "#c62828"
}
