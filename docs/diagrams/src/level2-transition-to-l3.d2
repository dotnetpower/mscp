direction: down

L2Arch: "Level 2 Architecture" {
  style: { fill: "#fff3e0"; stroke: "#ff9800"; border-radius: 8; shadow: true }
  P2: "Perception" { style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 } }
  W2: "World Model" { style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 } }
  G2: "Goal System" { style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 } }
  A2: "Action Planner" { style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 } }
  C2: "LLM" { style: { fill: "#ffe0b2"; stroke: "#ef6c00"; border-radius: 6 } }
  P2 -> W2 -> G2 -> A2 -> C2 { style.animated: true }
}

NewModules: "ðŸ†• New Modules for Level 3" {
  style: { fill: "#e3f2fd"; stroke: "#2196f3"; border-radius: 8; shadow: true }
  SM: "Self Model\n(Identity + Capability + Value)" { style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 } }
  PE: "Prediction Engine\n(external + internal)" { style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 } }
  MC: "MetaCognition Comparator\n(predict vs actual)" { style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 } }
  SUL: "Self-Update Loop\n(delta-clamped)" { style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 } }
  EK: "Ethical Kernel\n(Layer 0 + Layer 1)" { style: { fill: "#bbdefb"; stroke: "#1976d2"; border-radius: 6 } }
}

L3Arch: "Level 3 Architecture" {
  style: { fill: "#e8f5e9"; stroke: "#4caf50"; border-radius: 8; shadow: true }

  Row1: "Perception & Modeling" {
    style: { fill: "#e8f5e9"; stroke: "#4caf50"; border-radius: 6; stroke-dash: 3 }
    P3: "Perception" { style: { fill: "#c8e6c9"; stroke: "#388e3c"; border-radius: 6 } }
    W3: "World Model" { style: { fill: "#c8e6c9"; stroke: "#388e3c"; border-radius: 6 } }
    SM3: "Self Model â˜…" { style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6; bold: true } }
    PE3: "Prediction â˜…" { style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6; bold: true } }
    P3 -> W3 -> SM3 -> PE3 { style.animated: true }
  }

  Row2: "Decision & Execution" {
    style: { fill: "#e8f5e9"; stroke: "#4caf50"; border-radius: 6; stroke-dash: 3 }
    G3: "Goal Generator" { style: { fill: "#c8e6c9"; stroke: "#388e3c"; border-radius: 6 } }
    EK3: "Ethical Kernel â˜…" { style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6; bold: true } }
    A3: "Action Planner" { style: { fill: "#c8e6c9"; stroke: "#388e3c"; border-radius: 6 } }
    C3: "LLM" { style: { fill: "#c8e6c9"; stroke: "#388e3c"; border-radius: 6 } }
    G3 -> EK3 -> A3 -> C3 { style.animated: true }
  }

  Row3: "Feedback Loop â˜…" {
    style: { fill: "#e8f5e9"; stroke: "#2e7d32"; border-radius: 6; stroke-dash: 3 }
    MC3: "MetaComparator â˜…" { style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6; bold: true } }
    SUL3: "Self-Update â˜…" { style: { fill: "#a5d6a7"; stroke: "#2e7d32"; border-radius: 6; bold: true } }
    MC3 -> SUL3 { style.animated: true }
  }

  Row1.PE3 -> Row2.G3 { style.animated: true }
  Row2.C3 -> Row3.MC3: "result" { style.animated: true; style.stroke-dash: 5; style.stroke: "#2e7d32" }
  Row3.SUL3 -> Row1.SM3: "update" { style.animated: true; style.stroke: "#2e7d32" }
}

# Flow connections
L2Arch -> NewModules: "evolves with" {
  style.animated: true
  style.stroke: "#2196f3"
  style.stroke-width: 2
}

NewModules -> L3Arch: "integrates into" {
  style.animated: true
  style.stroke: "#4caf50"
  style.stroke-width: 3
}

# Module-to-component mapping
NewModules.SM -> L3Arch.Row1.SM3: "" {
  style.stroke-dash: 5
  style.stroke: "#1976d2"
  style.animated: true
}
NewModules.PE -> L3Arch.Row1.PE3: "" {
  style.stroke-dash: 5
  style.stroke: "#1976d2"
  style.animated: true
}
NewModules.MC -> L3Arch.Row3.MC3: "" {
  style.stroke-dash: 5
  style.stroke: "#1976d2"
  style.animated: true
}
NewModules.SUL -> L3Arch.Row3.SUL3: "" {
  style.stroke-dash: 5
  style.stroke: "#1976d2"
  style.animated: true
}
NewModules.EK -> L3Arch.Row2.EK3: "" {
  style.stroke-dash: 5
  style.stroke: "#1976d2"
  style.animated: true
}
