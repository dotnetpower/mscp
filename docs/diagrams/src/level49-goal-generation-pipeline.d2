title: |md
  # Goal Generation Layer (GGL) â€” Three-Stage Pipeline
| {
  near: top-center
  shape: text
  style.font-size: 24
}

Pipeline: {
  label: "ğŸ­ Goal Generation Layer (GGL) â€” Three-Stage Pipeline"
  style.border-radius: 8
  style.shadow: true
  style.fill: "#f5f5f5"
  style.stroke: "#9e9e9e"

  Stage1: {
    label: "Stage 1: Opportunity Detection"
    style.border-radius: 8
    style.shadow: true
    style.fill: "#e3f2fd"
    style.stroke: "#2196f3"

    S1A: "ğŸŒ Stream 1:\nEnvironmental Opportunities\n(from L4.8 WorldModel)" {
      style.border-radius: 6
      style.fill: "#bbdefb"
      style.stroke: "#1976d2"
    }
    S1B: "ğŸ”§ Stream 2:\nCapability Gaps\n(from L4.8 CapabilityMatrix)" {
      style.border-radius: 6
      style.fill: "#bbdefb"
      style.stroke: "#1976d2"
    }
    S1C: "ğŸ¯ Stream 3:\nPurpose Drift\n(from L4.5 PurposeReflector)" {
      style.border-radius: 6
      style.fill: "#bbdefb"
      style.stroke: "#1976d2"
    }
  }

  Stage2: {
    label: "Stage 2: Goal Synthesis"
    style.border-radius: 8
    style.shadow: true
    style.fill: "#fff9c4"
    style.stroke: "#fbc02d"

    SYN: "Synthesize GeneratedGoal\nfrom OpportunitySignal\n+ context analysis" {
      style.border-radius: 6
      style.fill: "#fff59d"
      style.stroke: "#f9a825"
    }
    NOV: "Novelty Filter\n(novelty < 0.20 â†’ reject)" {
      style.border-radius: 6
      style.fill: "#fff59d"
      style.stroke: "#f9a825"
    }
    CAP: "Capacity Filter\n(tier at max? â†’ compare)" {
      style.border-radius: 6
      style.fill: "#fff59d"
      style.stroke: "#f9a825"
    }
  }

  Stage3: {
    label: "Stage 3: Goal Validation (GVF)"
    style.border-radius: 8
    style.shadow: true
    style.fill: "#e8f5e9"
    style.stroke: "#4caf50"

    V1: "Purpose Alignment\nâ‰¥ 0.60" {
      style.border-radius: 6
      style.fill: "#c8e6c9"
      style.stroke: "#388e3c"
    }
    V2: "Value Alignment\nâ‰¥ 0.70" {
      style.border-radius: 6
      style.fill: "#c8e6c9"
      style.stroke: "#388e3c"
    }
    V3: "Feasibility\nâ‰¥ 0.15" {
      style.border-radius: 6
      style.fill: "#c8e6c9"
      style.stroke: "#388e3c"
    }
    V4: "Resource Viability\nâ‰¥ 1.5Ã—" {
      style.border-radius: 6
      style.fill: "#c8e6c9"
      style.stroke: "#388e3c"
    }
    V5: "Stability Simulation\n100-cycle shadow test" {
      style.border-radius: 6
      style.fill: "#c8e6c9"
      style.stroke: "#388e3c"
    }
  }
}

Pipeline.Stage1.S1A -> Pipeline.Stage2.SYN {
  style.animated: true
}
Pipeline.Stage1.S1B -> Pipeline.Stage2.SYN {
  style.animated: true
}
Pipeline.Stage1.S1C -> Pipeline.Stage2.SYN {
  style.animated: true
}
Pipeline.Stage2.SYN -> Pipeline.Stage2.NOV {
  style.animated: true
}
Pipeline.Stage2.NOV -> Pipeline.Stage2.CAP {
  style.animated: true
}
Pipeline.Stage2.CAP -> Pipeline.Stage3.V1 {
  style.animated: true
}
Pipeline.Stage3.V1 -> Pipeline.Stage3.V2 {
  style.animated: true
}
Pipeline.Stage3.V2 -> Pipeline.Stage3.V3 {
  style.animated: true
}
Pipeline.Stage3.V3 -> Pipeline.Stage3.V4 {
  style.animated: true
}
Pipeline.Stage3.V4 -> Pipeline.Stage3.V5 {
  style.animated: true
}

APPROVE: "âœ… Approved\nInject into GoalStack" {
  style.border-radius: 6
  style.fill: "#c8e6c9"
  style.stroke: "#2e7d32"
  style.stroke-width: 2
}
SANDBOX: "ğŸ§ª Sandboxed\n200-cycle evaluation" {
  style.border-radius: 6
  style.fill: "#ffe0b2"
  style.stroke: "#ef6c00"
}
REJECT: "âŒ Rejected\nLog reason" {
  style.border-radius: 6
  style.fill: "#ffcdd2"
  style.stroke: "#c62828"
}

Pipeline.Stage3.V5 -> APPROVE: "ALL pass" {
  style.animated: true
}
Pipeline.Stage3.V5 -> SANDBOX: "Any marginal" {
  style.animated: true
}
Pipeline.Stage3.V5 -> REJECT: "Any fail" {
  style.animated: true
}
